<html>
    <head>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <link href="https://fonts.cdnfonts.com/css/harry-p" rel="stylesheet">

        <style>
            body {
                font-family: sans-serif;
                cursor: url('HP_OnlyWand.png'), auto;
                background-image: url('HP_Back.png');
                background-size: cover; 
                background-repeat: no-repeat;
                background-position: center;

            }

            h1 {
                font-family: 'Harry P', sans-serif;
                font-weight: 400;
                font-size: 39pt;
                text-align: center;
                margin: 30px;
                color: white;
            }

            .axis text {
            fill: white; 
             }

       
            .axis path,
            .axis line {
                stroke: white; 
            }

            .axis-label {
                fill: white; 
            }

        </style>
    </head>
    <body>
        <h1>Deep Dive into the Dangers of the Harry Potter Universe</h1>

        <!-- Node graph -->
         <div>
            <svg id="node-graph" height="600" width="600"></svg>
            <script>
                // node graph
                const nodeGraph = d3.select('svg#node-graph');

                const nodeLayer = d3.select('#node-graph').append('g');
                const nodeWidth = d3.select('#node-graph').attr('width');
                const nodeHeight = d3.select('#node-graph').attr('height');

                const requestNodeData = async () => {
                    const megafile = await d3.csv('megafile.csv');
                    console.log(megafile);

                };

                requestNodeData();
            </script>
         </div>

        <!-- Bar Graph -->
        <svg id="bar-graph" height="600" width="600"></svg>
        <script>
            // Load the CSV file
            const requestData = async function() {
                const spells = await d3.csv("megafile.csv");

                // Spell Colors
                const spellColors = {
                    "Avada Kedavra": "#28A745",
                    "Confringo": "#FF4500",
                    "Incendio": "#FF6347",
                    "Morsmordre": "#6EBB97",
                    "Sectumsempra": "#8B0000",
                    "Stupefy": "#E8913D",
                    "Crucio": "#48493E",
                    "Imperio": "#FBD748",
                    "Confundo": "#834F99",
                    "Expelliarmus": "#DA3832",
                    "Petrificus Totalus": "#4782B4",
                    "Obliviate": "#F5DEB3",
                    "Expecto Patronum": "#8CCBF0"
                };

                const barWidth = 600;
                const barHeight = 600;
                const margin = { top: 20, right: 30, bottom: 100, left: 60 }; 

                // Bar Chart Dimensions
                const barSvg = d3.select("#bar-graph")
                    .attr("width", barWidth + margin.left + margin.right)
                    .attr("height", barHeight + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform", `translate(${margin.left},${margin.top})`);

                // Calculate spell usage
                const spellUsage = d3.rollup(spells, v => v.length, d => d.spell_name);
                const spellData = Array.from(spellUsage, ([spell, count]) => ({ spell, count }));

                // Scales for the bar chart
                const x = d3.scaleBand()
                    .domain(spellData.map(d => d.spell))
                    .range([0, barWidth])
                    .padding(0.1);
                const y = d3.scaleLinear()
                    .domain([0, d3.max(spellData, d => d.count)])
                    .nice()
                    .range([barHeight, 0]);

                // Add bars to the bar chart
                barSvg.append("g")
                    .selectAll("rect")
                    .data(spellData)
                    .enter().append("rect")
                    .attr("x", d => x(d.spell))
                    .attr("y", d => y(d.count))
                    .attr("width", x.bandwidth())
                    .attr("height", d => barHeight - y(d.count))
                    .attr("fill", d => spellColors[d.spell] ); 


                // Add X and Y axes
                barSvg.append("g")
                    .attr("transform", `translate(0,${barHeight})`)
                    .call(d3.axisBottom(x))
                    .attr("class", "axis") 
                    .selectAll("text")
                    .attr("transform", "rotate(-45)")
                    .style("text-anchor", "end");


                barSvg.append("g").call(d3.axisLeft(y))
                    .attr("class", "axis");

                // Add axis labels
                barSvg.append("text")
                    .attr("x", barWidth / 2)
                    .attr("y", barHeight + 80)
                    .attr("text-anchor", "middle")
                    .attr("class", "axis-label")
                    .text("Spell Name");

                barSvg.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("x", -barHeight / 2)
                    .attr("y", -margin.left + 20)
                    .attr("text-anchor", "middle")
                    .attr("class", "axis-label")
                    .text("Spell Usage");
            };

            requestData();
        </script>

        <!-- Spider graph -->
        <!-- <div> -->
            <svg id="spider-graph" height="600" width="600"></svg>
            <script>
                const graph = d3.select('svg#spider-graph');
                const height = graph.attr('height');
                const width = graph.attr('width');

                d3.csv('norm_spell_stats.csv').then((spells) => {
                    console.log(spells)

                    let data = []
                    let features = ["Damage", "Range", "Cooldown", "Duration", "CD OOC"];
                    //generate the data
                    for (var i = 0; i < spells.length; i++){
                        var point = {}
                        //each feature will be a random number from 1-9
                        features.forEach(f => point[f] = 1 + Math.random() * 8);
                        data.push({
                            'Damage': Number(spells[i]['Damage']),
                            'Range': Number(spells[i]['Range']),
                            'Cooldown': Number(spells[i]['Cooldown']),
                            'Duration': Number(spells[i]['Duration']),
                            'CD OOC': Number(spells[i]['CD OOC'])
                        });
                    }


                    console.log(data);

                    let width = 600;
                    let height = 600;
                    let svg = d3.select("body").append("svg")
                        .attr("width", width)
                        .attr("height", height);

                        let radialScale = d3.scaleLinear()
                        .domain([0, 1])
                        .range([0, 250]);
                    let ticks = [.2, .4, .6, .8, 1.0];

                    svg.selectAll("circle")
                        .data(ticks)
                        .join(
                            enter => enter.append("circle")
                                .attr("cx", width / 2)
                                .attr("cy", height / 2)
                                .attr("fill", "none")
                                .attr("stroke", "gray")
                                .attr("r", d => radialScale(d))
                        );

                        svg.selectAll(".ticklabel")
                        .data(ticks)
                        .join(
                            enter => enter.append("text")
                                .attr("class", "ticklabel")
                                .attr("x", width / 2 + 5)
                                .attr("y", d => height / 2 - radialScale(d))
                                .text(d => d.toString())
                                .style("fill", "white")
                        );

                        function angleToCoordinate(angle, value){
                        let x = Math.cos(angle) * radialScale(value);
                        let y = Math.sin(angle) * radialScale(value);
                        return {"x": width / 2 + x, "y": height / 2 - y};
                    }   

                    let featureData = features.map((f, i) => {
                        let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
                        return {
                            "name": f,
                            "angle": angle,
                            "line_coord": angleToCoordinate(angle, 1),
                            "label_coord": angleToCoordinate(angle, 1.15)
                        };
                    });

                    // draw axis line
                    svg.selectAll("line")
                        .data(featureData)
                        .join(
                            enter => enter.append("line")
                                .attr("x1", width / 2)
                                .attr("y1", height / 2)
                                .attr("x2", d => d.line_coord.x)
                                .attr("y2", d => d.line_coord.y)
                                .attr("stroke","black")
                        );

                    // draw axis label
                    svg.selectAll(".axislabel")
                        .data(featureData)
                        .join(
                            enter => enter.append("text")
                                .attr("x", d => d.label_coord.x)
                                .attr("y", d => d.label_coord.y)
                                .text(d => d.name)
                                .style("fill", "white")
                        );

                        let line = d3.line()
                        .x(d => d.x)
                        .y(d => d.y);
                    let colors = ["#28A745", "#FF4500", "#48493E", "#DA3832", "#FBD748", "#FF6347", "#4782B4"];

                    function getPathCoordinates(data_point){
                        let coordinates = [];
                        for (var i = 0; i < features.length; i++){
                            let ft_name = features[i];
                            let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
                            coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
                        }
                        return coordinates;
                    }

                    svg.selectAll("path")
                        .data(data)
                        .join(
                            enter => enter.append("path")
                                .datum(d => getPathCoordinates(d))
                                .attr("d", line)
                                .attr("stroke-width", 3)
                                .attr("stroke", (_, i) => colors[i])
                                .attr("fill", (_, i) => colors[i])
                                .attr("stroke-opacity", 1)
                                .attr("opacity", 0.5)
                        );

                })


            </script>
        <!-- </div> -->
    </body>
</html>